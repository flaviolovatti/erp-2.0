CREATE OR ALTER VIEW VIEW_60R
(
 GTIN,
 SERIE,
 DATA_EMISSAO,
 MES_EMISSAO,
 ANO_EMISSAO,
 ID,
 ECF_ICMS_ST,
 SOMA_QUANTIDADE,
 SOMA_ITEM,
 SOMA_BASE_ICMS,
 SOMA_ICMS 
) AS 

select VD.GTIN,i.SERIE,vc.DATA_VENDA AS DATA_EMISSAO,m.ID,VD.ECF_ICMS_ST,
      EXTRACT(MONTH from(vc.DATA_VENDA)) AS MES_EMISSAO,
      EXTRACT(YEAR from(vc.DATA_VENDA)) AS ANO_EMISSAO,
      COALESCE(sum(vd.QUANTIDADE),0) AS SOMA_QUANTIDADE,
      COALESCE(sum(vd.TOTAL_ITEM),0) AS SOMA_ITEM,
      COALESCE(sum(vd.BASE_ICMS),0) AS SOMA_BASE_ICMS,
      COALESCE(sum(vd.ICMS),0) AS SOMA_ICMS
  from ECF_VENDA_CABECALHO vc
  LEFT JOIN ecf_venda_detalhe vd ON (vd.ID_ECF_VENDA_CABECALHO = vc.ID)
  LEFT JOIN ecf_movimento m ON (vc.ID_ECF_MOVIMENTO = m.ID)
  LEFT JOIN ecf_impressora i ON (m.ID_ECF_IMPRESSORA = i.ID)
  GROUP BY EXTRACT(MONTH from(vc.DATA_VENDA)),EXTRACT(YEAR from(vc.DATA_VENDA)),VD.GTIN,i.SERIE,vc.DATA_VENDA,m.ID,VD.ECF_ICMS_ST

;

