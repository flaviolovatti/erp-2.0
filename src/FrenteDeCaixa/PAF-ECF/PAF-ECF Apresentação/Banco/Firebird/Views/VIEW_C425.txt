CREATE OR ALTER VIEW VIEW_C425
(
 ID_ECF_PRODUTO,
 ID_UNIDADE_PRODUTO,
 DESCRICAO_UNIDADE,
 TOTALIZADOR_PARCIAL,
 DATA_VENDA,
 SOMA_QUANTIDADE,
 SOMA_ITEM,
 SOMA_PIS,
 SOMA_COFINS 
) AS 

select vd.ID_ECF_PRODUTO, p.ID_UNIDADE_PRODUTO AS ID_UNIDADE_PRODUTO,  u.NOME AS DESCRICAO_UNIDADE, vd.TOTALIZADOR_PARCIAL AS TOTALIZADOR_PARCIAL,  vc.DATA_VENDA, COALESCE(sum(vd.QUANTIDADE),0) AS SOMA_QUANTIDADE,
COALESCE(sum(vd.VALOR_TOTAL),0) AS SOMA_ITEM,
COALESCE(sum(vd.PIS),0) AS SOMA_PIS,
COALESCE(sum(vd.COFINS),0) AS SOMA_COFINS
from ECF_VENDA_DETALHE vd
LEFT JOIN ECF_VENDA_CABECALHO vc ON (vd.ID_ECF_VENDA_CABECALHO = vc.ID)
LEFT JOIN PRODUTO p ON (vd.ID_ECF_PRODUTO = p.ID)
LEFT JOIN UNIDADE_PRODUTO u ON (p.ID_UNIDADE_PRODUTO = u.ID)
GROUP BY vd.ID_ECF_PRODUTO,
 p.ID_UNIDADE_PRODUTO,
 u.NOME,
 vd.TOTALIZADOR_PARCIAL,
 vc.DATA_VENDA

;

