CREATE OR ALTER VIEW VIEW_E110
(
 DATA_EMISSAO,
 SOMA_ICMS 
) AS 

select vc.DATA_VENDA AS DATA_EMISSAO,
       COALESCE(sum(vd.ICMS),0) AS SOMA_ICMS
from ECF_VENDA_CABECALHO vc
INNER JOIN ECF_VENDA_DETALHE vd ON (vd.ID_ECF_VENDA_CABECALHO = vc.ID)
where vd.cancelado='N'
group by vc.DATA_VENDA
union
select NFc.DATA_EMISSAO AS DATA_EMISSAO, COALESCE(sum(NFd.ICMS),0) AS SOMA_ICMS
from NOTA_FISCAL_CABECALHO NFc
INNER JOIN NOTA_FISCAL_DETALHE NFd ON (NFd.id_nf_cabecalho = NFc.ID)
group by NFc.DATA_EMISSAO

;

