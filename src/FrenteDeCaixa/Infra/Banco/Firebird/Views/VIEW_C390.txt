CREATE OR ALTER VIEW VIEW_C390
(
 CST,
 CFOP,
 TAXA_ICMS,
 DATA_EMISSAO,
 SOMA_ITEM,
 SOMA_BASE_ICMS,
 SOMA_ICMS,
 SOMA_ICMS_OUTRAS 
) AS 

select NFd.CST,NFd.CFOP,NFd.TAXA_ICMS, NFc.DATA_EMISSAO,
 COALESCE(sum(NFd.VALOR_TOTAL),0) AS SOMA_ITEM,
 COALESCE(sum(NFd.BASE_ICMS),0) AS SOMA_BASE_ICMS,
 COALESCE(sum(NFd.ICMS),0) AS SOMA_ICMS,
 COALESCE(sum(NFd.ICMS_OUTRAS),0) AS SOMA_ICMS_OUTRAS
 from NOTA_FISCAL_DETALHE NFd
 INNER JOIN NOTA_FISCAL_CABECALHO NFc ON (NFd.id_nf_cabecalho = NFc.ID)
 GROUP BY NFd.CST,NFd.CFOP,NFd.TAXA_ICMS,NFc.DATA_EMISSAO

;

