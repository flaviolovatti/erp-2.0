CREATE OR ALTER VIEW VIEW_MEIOS_PAGAMENTO
(
 DATA_ACUMULADO,
 ID_ECF_IMPRESSORA,
 DESCRICAO,
 TOTAL 
) AS 

SELECT v.DATA_VENDA AS DATA_ACUMULADO,
       m.ID_ECF_IMPRESSORA,
       p.DESCRICAO,COALESCE(sum(tp.VALOR),0) AS TOTAL
 FROM ECF_VENDA_CABECALHO v
 INNER JOIN ECF_MOVIMENTO m        ON (v.ID_ECF_MOVIMENTO = m.ID)
 INNER JOIN ECF_TOTAL_TIPO_PGTO tp ON (v.ID = tp.ID_ECF_VENDA_CABECALHO)
 INNER JOIN ECF_TIPO_PAGAMENTO p   ON (tp.ID_ECF_TIPO_PAGAMENTO = p.ID)

 GROUP BY p.DESCRICAO,v.DATA_VENDA,m.ID_ECF_IMPRESSORA

 UNION
 
 SELECT s.DATA_SUPRIMENTO AS DATA_ACUMULADO,
        m.ID_ECF_IMPRESSORA,
        'SUPRIMENTO' AS DESCRICAO,
        COALESCE(sum(s.VALOR),0) AS TOTAL
 from ECF_SUPRIMENTO s
 INNER JOIN ECF_MOVIMENTO m ON (s.ID_ECF_MOVIMENTO = m.ID)
 group by 'SUPRIMENTO',s.DATA_SUPRIMENTO,m.ID_ECF_IMPRESSORA

;

