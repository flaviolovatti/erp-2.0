CREATE OR ALTER VIEW VIEW_C321
(
 ID_PRODUTO,
 DESCRICAO_UNIDADE,
 DATA_EMISSAO,
 SOMA_QUANTIDADE,
 SOMA_ITEM,
 SOMA_DESCONTO,
 SOMA_BASE_ICMS,
 SOMA_ICMS,
 SOMA_PIS,
 SOMA_COFINS 
) AS 

select NFd.ID_PRODUTO,
       u.NOME AS DESCRICAO_UNIDADE,
       NFc.DATA_EMISSAO,
COALESCE(sum(NFd.QUANTIDADE),0) AS SOMA_QUANTIDADE,
COALESCE(sum(NFd.VALOR_TOTAL),0) AS SOMA_ITEM,
COALESCE(sum(NFd.DESCONTO),0) AS SOMA_DESCONTO,
COALESCE(sum(NFd.BASE_ICMS),0) AS SOMA_BASE_ICMS,
COALESCE(sum(NFd.ICMS),0) AS SOMA_ICMS,
COALESCE(sum(NFd.PIS),0) AS SOMA_PIS,
COALESCE(sum(NFd.COFINS),0) AS SOMA_COFINS
  from NOTA_FISCAL_DETALHE NFd
  LEFT JOIN NOTA_FISCAL_CABECALHO NFc ON (NFd.id_nf_cabecalho = NFc.ID)
  LEFT JOIN PRODUTO p ON (NFd.ID_PRODUTO = p.ID)
  LEFT JOIN UNIDADE_PRODUTO u ON (p.ID_UNIDADE_PRODUTO = u.ID)
  GROUP BY NFd.ID_PRODUTO,u.NOME,NFc.DATA_EMISSAO

;

